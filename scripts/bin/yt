#!/usr/bin/env bash
set -euox pipefail

if [ $# -eq 0 ]; then
  url="$(wl-paste)"
elif [ $# -eq 1 ]; then
  url="$1"
else
  exit 1
fi

export SWAYSOCK=$(sway --get-socketpath)

vertical_res="$(swaymsg -t get_outputs | jq 'max_by(.current_mode.height).current_mode.height')"
youtubedl_format="bestvideo[height<=${vertical_res}]+bestaudio/best[height<=${vertical_res}]"

playerctl pause || :
mpv --speed=1.5 --ytdl-format="$youtubedl_format" "$url"
