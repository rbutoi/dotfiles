# -*- mode: i3wm-config; -*-
# sway config

#
# basics
#

set $term       wezterm start --
set $term_tmux  $term tmux new -As auto
set $term_emacs $term emacsclient -nw -a=
set $web        google-chrome-unstable
set $files      xdg-open ~
set $menu       fuzzel
set $locker     "swaylock --show-failed-attempts --ignore-empty-password \
  --show-keyboard-layout --daemonize --screenshots                       \
  --indicator --indicator-radius 100 --indicator-thickness 7             \
  --effect-blur 5x5 --grace 0.5 --fade-in 0.25"

#
# input/output
#
input type:keyboard {
    xkb_options ctrl:nocaps
    repeat_delay 250
    repeat_rate 30
}
input type:pointer {
    accel_profile flat
    pointer_accel -0.4
}
input 1203:12557:HID_04b3:310d pointer_accel 0.5

# manages displays
exec_always sh -c "pkill kanshi; exec kanshi -c ~/.config/kanshi/$HOSTNAME"

#
# startup applications
#
exec_always sh -c "pkill waybar; exec waybar"

# daemons
exec systemd-cat udiskie --tray --appindicator # automount manager
exec systemd-cat nm-applet --indicator         # network status
exec systemd-cat poweralertd                   # power notifications
exec systemd-cat wlsunset_here                 # sunset screen darken

exec systemctl --user enable --now wob.service # some redundancy
set $WOBSOCK $XDG_RUNTIME_DIR/wob.sock

# clipboard
exec systemd-cat wl-paste -t text --watch clipman store --max-items 1024

# initial desktop
exec systemd-cat dex -a -e SWAY # autostart
exec systemd-cat sh -c 'sleep 1; $web'
exec systemd-cat $term_tmux
# exec systemd-cat signal-desktop

#
# per window config
#
# Chrome notifications have empty id/title.
for_window [app_id="^$" title="^$"] floating enable, move position 80 ppt 83 ppt
no_focus   [app_id="^$" title="^$"]
# chrome apps steal Mod4 for some reason
for_window [app_id="chrome"] shortcuts_inhibitor disable
# this is clicked in tray
for_window [app_id="gsimplecal"] move position mouse, move up 40 px, move left 20 px
# opacity
for_window [app_id="^emacs"]              opacity 0.93
for_window [app_id="^gnome-terminal-server" title="Terminal"] opacity 0.95
for_window [app_id="^nemo"]               opacity 0.95
for_window [app_id="^org.gnome.Nautilus"] opacity 0.925
for_window [class="^Emacs"]               opacity 0.93
# floating - by native Wayland `app_id`
for_window [app_id="^blueman-manager"]             floating enable
for_window [app_id="^cinnamon-settings.py"]        floating enable
for_window [app_id="^eog"]                         floating enable
for_window [app_id="^exo-desktop-item-edit"]       floating enable
for_window [app_id="^font-viewer$"]                floating enable
for_window [app_id="^fsearch$"]                    floating enable; opacity 0.95
for_window [app_id="^gnome-control-center"]        floating enable
for_window [app_id="^gnome-power-statistics"]      floating enable
for_window [app_id="^goobuntu_indicator.py"]       floating enable
for_window [app_id="^gyrc"]                        floating enable
for_window [app_id="^nwg-look"]                    floating enable
for_window [app_id="^org.gnome.Calculator"]        floating enable
for_window [app_id="^org.gnome.Weather"]           floating enable
for_window [app_id="^org.gnome.font-viewer"]       floating enable
for_window [app_id="^pavucontrol"]                 floating enable
for_window [app_id="^qalculate-gtk"]               floating enable
for_window [app_id="^wdisplays"]                   floating enable
for_window [app_id="^wev"]                         floating enable
for_window [app_id="^xfce4-appfinder"]             floating enable
for_window [app_id="^zenity"]                      floating enable
# by X11 class
for_window [class="1Password"]                     floating enable
for_window [class="Cemu"]                          floating enable; inhibit_idle
for_window [class="PCSX2"]                         floating enable
for_window [class="steam_app_.*"]                  floating enable
for_window [class="steam_proton"]                  floating enable
# by title
for_window [title="Find Directory"]                floating enable
for_window [title="Firefox - Sharing Indicator"]   floating enable
for_window [title="^(Open|Save) Files?$"]          floating enable
for_window [title="^Close Firefox$"]               floating enable
for_window [title="^Compose Mail"]                 floating enable
for_window [title="^Edit with Emacs FRAME$"]       floating enable
for_window [title="^Picture in picture$"]          floating enable; sticky enable
for_window [title="^Preferences$"]                 floating enable
# workspace assignments
assign [class="hl2_linux"]                workspace 3
assign [class="Signal"]                   workspace 7
assign [class="discord"]                  workspace 4
assign [app_id="chrome-kjbdgfilnfhdoflbpgamdcdgpehopbep-Profile_1"] workspace 4
assign [app_id="chrome-mdpkiolbdkhdjpekfbkbmhigcaggjagi-Profile_1"] workspace 4

#
# display
#
font Noto Sans 12
default_border pixel 6
smart_borders on
smart_gaps on
hide_edge_borders --i3 both
floating_maximum_size 0 x 0
titlebar_border_thickness 0

set $base00_ "#282828"
set $base02_ "#504945"
set $base03_ "#665c54"
set $base04_ "#bdae93"
set $base08_ "#fb4934"
set $base0C_ "#8ec07c"
set $base0D_ "#83a598"
set $base10_ "#231f20"

client.focused          $base0D_   $base0D_   $base00_ $base0C_ $base0D_
client.focused_inactive $base02_c0 $base02_c0 $base04_ $base04_ $base02_
client.unfocused        $base02_c0 $base10_c0 $base04_ $base03_ $base02_
client.urgent           $base08_   $base08_   $base00_ $base08_ $base08_
gaps inner   12
gaps outer    8
 # to grab scroll/tabbar, no right/top gap
gaps top    -12
gaps right  -12

#
# Keybindings - basics:
#

# super
set $S Mod4
set $C Ctrl
set $M Alt

set $left   h
set $down   j
set $up     k
set $right  l

bindsym $S+c               kill
bindsym $M+F4              kill
bindsym $S+Shift+q         reload
bindsym $S+Shift+Backspace exit
#
# Moving around:
#
bindsym $S+$left        focus left
bindsym $S+$down        focus down
bindsym $S+$up          focus up
bindsym $S+$right       focus right
# _move_ the focused window with the same, but add Shift
bindsym $S+Shift+$left  move left
bindsym $S+Shift+$down  move down
bindsym $S+Shift+$up    move up
bindsym $S+Shift+$right move right
#
# Workspaces:
#
workspace_auto_back_and_forth yes
mouse_warping output
# switch to workspace
bindsym --no-repeat $S+1                            workspace 1
bindsym --no-repeat $S+2                            workspace 2
bindsym --no-repeat $S+3                            workspace 3
bindsym --no-repeat $S+4                            workspace 4
bindsym --no-repeat $S+5                            workspace 5
bindsym --no-repeat $S+6                            workspace 6
bindsym --no-repeat $S+7                            workspace 7
bindsym --no-repeat $S+8                            workspace 8
bindsym --no-repeat $S+9                            workspace 9
bindsym --no-repeat $S+$C+1                         workspace 1
bindsym --no-repeat $S+$C+2                         workspace 2
bindsym --no-repeat $S+$C+3                         workspace 3
bindsym --no-repeat $S+$C+4                         workspace 4
bindsym --no-repeat $S+$C+5                         workspace 5
bindsym --no-repeat $S+$C+6                         workspace 6
bindsym --no-repeat $S+$C+7                         workspace 7
bindsym --no-repeat $S+$C+8                         workspace 8
bindsym --no-repeat $S+$C+9                         workspace 9
# move focused                         container to workspace
bindsym --no-repeat $S+Shift+1    move container to workspace 1
bindsym --no-repeat $S+Shift+2    move container to workspace 2
bindsym --no-repeat $S+Shift+3    move container to workspace 3
bindsym --no-repeat $S+Shift+4    move container to workspace 4
bindsym --no-repeat $S+Shift+5    move container to workspace 5
bindsym --no-repeat $S+Shift+6    move container to workspace 6
bindsym --no-repeat $S+Shift+7    move container to workspace 7
bindsym --no-repeat $S+Shift+8    move container to workspace 8
bindsym --no-repeat $S+Shift+9    move container to workspace 9
bindsym --no-repeat $S+Shift+0    move container to workspace 0
# other monitor
bindsym --no-repeat $S+Shift+n    move container to output left ; focus output left
bindsym --no-repeat $S+Shift+m    move container to output right; focus output right
# MRU workspace
bindsym --no-repeat $S+Tab          workspace back_and_forth
# next and previous workspace
bindsym --no-repeat $S+n          focus output left
bindsym --no-repeat $S+m          focus output right
bindsym --no-repeat $S+$C+p     workspace prev_on_output
bindsym --no-repeat $S+Prior      workspace prev_on_output
bindsym --whole-window $S+button4 workspace prev_on_output
bindsym --no-repeat $S+$C+n     workspace next_on_output
bindsym --no-repeat $S+Next       workspace next_on_output
bindsym --whole-window $S+button5 workspace next_on_output
#
# Layout stuff:
#
floating_modifier $S
bindsym $S+Shift+b  splith
bindsym $S+Shift+v  splitv
bindsym $S+s        layout stacking
bindsym $S+Shift+s  layout tabbed
bindsym $S+d        layout toggle split
bindsym $S+f        fullscreen
bindsym $S+t        floating toggle
bindsym $S+$C+t   focus mode_toggle
bindsym $S+Shift+t  sticky toggle; exec ~/.config/sway/bin/notify_sticky_status.sh
bindsym $S+a        focus parent
bindsym $S+Shift+a  focus child

#
# Scratchpad:
#
bindsym $S+Shift+z     move scratchpad
bindsym $S+z           scratchpad show
#
# Resizing containers:
#
bindsym $S+$C+$left   resize shrink width  100px
bindsym $S+$C+$down   resize grow   height 100px
bindsym $S+$C+$up     resize shrink height 100px
bindsym $S+$C+$right  resize grow   width  100px

#
# App keys:
#
bindsym $S+Return               exec $term
bindsym $S+Shift+Return         exec                           \
  swaymsg '[app_id="wezterm" title="\\[auto\\]"] focus'     || $term_tmux
bindsym $S+w                    exec                           \
  swaymsg '[app_id="[Gg]oogle-chrome"] focus'               || \
  swaymsg '[app_id="firefox"] focus'                        || $web
bindsym $S+e                    exec                           \
  swaymsg '[app_id="wezterm" title="emacsclient\\."] focus' || \
  swaymsg '[app_id="emacs"] focus'                          || \
  swaymsg '[class="Emacs"] focus'                           || $term_emacs
bindsym $S+Shift+e              exec $term emacsclient -nw -aemacs
bindsym $S+Shift+w              exec $web
bindsym $S+Shift+f              exec $files
bindsym $M+F2                   exec $menu "-Srun"
bindsym $S+space                exec $menu
bindsym $S+Slash                exec fsearch
bindsym $S+Shift+space          exec fsearch
bindsym $S+q                    exec wlogout -p layer-shell

bindsym $S+Shift+$C+l           exec $locker
bindsym Print                   exec ~/.config/sway/bin/sway-interactive-screenshot
bindsym $S+v                    exec clipman pick --tool wofi --max-items 30
bindsym $S+$M+b                 exec footclient --fullscreen btop

# media - wob examples from https://github.com/francma/wob#sway-wm-example
bindsym XF86MonBrightnessDown   exec brightnessctl set 5%- | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK
bindsym XF86MonBrightnessUp     exec brightnessctl set +5% | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK
bindsym XF86AudioRaiseVolume    exec pamixer -ui 5 && pamixer --get-volume > $WOBSOCK
bindsym XF86AudioLowerVolume    exec pamixer -ud 5 && pamixer --get-volume > $WOBSOCK
bindsym $M+XF86AudioRaiseVolume exec pamixer -ui 1 && pamixer --get-volume > $WOBSOCK
bindsym $M+XF86AudioLowerVolume exec pamixer -ud 1 && pamixer --get-volume > $WOBSOCK
bindsym XF86AudioMute           exec pamixer --toggle-mute && ( [ "$(pamixer --get-mute)" = "true" ] && echo 0 > $WOBSOCK ) || pamixer --get-volume > $WOBSOCK
bindsym $S+XF86AudioMute        exec ~/bin/yamaha_vol mute
bindsym $S+F2                   exec ~/bin/yamaha_vol down
bindsym $S+F3                   exec ~/bin/yamaha_vol up
bindsym $S+F4                   exec ~/bin/yamaha_toggle_link.sh
bindsym $S+Shift+F4             exec notify-send -t 1500 ~/bin/yamaha_match_bedroom.py "$(~/bin/yamaha_match_bedroom.py)"
bindsym $S+F1                   exec ~/bin/yamaha_or_playerctl.sh play_pause
bindsym $S+Shift+F2             exec ~/bin/yamaha_or_playerctl.sh previous
bindsym $S+Shift+F3             exec ~/bin/yamaha_or_playerctl.sh next
bindsym XF86AudioPlay           exec ~/bin/yamaha_or_playerctl.sh play_pause
bindsym XF86AudioPrev           exec ~/bin/yamaha_or_playerctl.sh previous
bindsym XF86AudioNext           exec ~/bin/yamaha_or_playerctl.sh next
bindsym XF86AudioStop           exec ~/bin/yamaha_or_playerctl.sh stop
bindsym XF86Calculator          exec gnome-calculator

# debug window management
bindsym $S+Shift+$C+i           exec notify-send swayinfo "$(~/.local/bin/swayinfo)"
bindsym $S+Shift+$C+k           exec sh -c 'notify-send killing...; kill "$(~/.local/bin/swayinfo | grep "^pid=" | choose -f = 1)"'
bindsym $S+$M+k                 exec sh -c 'pkill wshowkeys; notify-send \"wshowkeys started; Super+Shift+Alt+k to kill\" && exec wshowkeys -a bottom -a right'
bindsym $S+Shift+$M+k           exec sh -c 'pkill wshowkeys; notify-send \"pkill wshowkeys: $?\"'

# system configs
include /etc/sway/config.d/*

# host-specific config
include ~/.config/sway/specific
